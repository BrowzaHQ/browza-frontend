name: Mirror main to personal repo

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: {}

permissions:
  contents: read

jobs:
  mirror:
    # Run ONLY in the org repo (prevents execution in the mirror repo)
    if: ${{ github.repository == 'BrowzaHQ/browza-frontend' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false   # avoid github-actions[bot] auth

      - name: Mirror to personal (verify then push)
        
        env:
          HOOK: ${{ secrets.VERCEL_DEPLOY_HOOK_MAIN }}
        run: |
          set -euo pipefail
          if [ -z "${HOOK:-}" ]; then
            echo "No Vercel deploy hook set (VERCEL_DEPLOY_HOOK_MAIN). Skipping."; exit 0; fi
          echo "Calling Vercel Deploy Hook for main (Preview)â€¦"
          curl -sS -X POST "$HOOK"
          echo "Hook called."

